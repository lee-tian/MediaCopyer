# 多源目录支持 - 修改说明

## 概述
此次更新为 MediaCopyer 添加了支持多个源目录的功能。用户现在可以同时选择多个源目录，程序会将所有源目录中的媒体文件整理到指定的目标目录中。

## 修改的文件

### 1. gui/main_window.py
- **DirectorySelector 类**: 新增支持多目录选择的通用组件
  - 支持添加、删除多个目录
  - 提供清晰的界面显示所有选中的目录
  - 包含验证功能确保目录有效性

- **MediaCopyerGUI 类**: 更新主界面以使用新的目录选择器
  - 将单个源目录输入替换为多目录选择器
  - 保持向后兼容性，支持单个和多个目录

### 2. gui/processor.py
- **FileProcessor 类**: 重构文件处理逻辑以支持多源目录
  - `start_processing` 方法现在接受源目录列表
  - `_process_files` 方法支持处理多个源目录到多个目标目录
  - 改进了进度跟踪和统计信息汇总
  - 增强了错误处理和日志记录

### 3. gui/locales/zh_CN.py 和 gui/locales/en_US.py
- 添加了新的本地化字符串支持多源目录界面
- 包括按钮标签、状态消息和错误提示

## 新增功能

### 多源目录选择
- 用户可以点击"添加源目录"按钮添加多个源目录
- 每个源目录都会在界面上显示，带有删除按钮
- 支持批量删除所有源目录

### 智能处理逻辑
- 程序会遍历所有源目录，扫描其中的媒体文件
- 每个源目录的文件都会被处理到所有指定的目标目录
- 在最后一个源目录和最后一个目标目录时才执行移动操作（如果选择移动模式）

### 改进的进度跟踪
- 显示当前正在处理的源目录和目标目录组合
- 提供整体进度条显示所有操作的完成情况
- 详细的日志记录，显示每个源目录到目标目录的处理结果

### 统计信息汇总
- 合并所有源目录和目标目录组合的统计信息
- 显示总的照片数、视频数、错误数和处理数
- 在处理完成后提供综合报告

## 使用方法

1. **添加源目录**:
   - 点击"添加源目录"按钮
   - 在文件对话框中选择源目录
   - 重复此步骤添加多个源目录

2. **管理源目录**:
   - 每个添加的源目录都会显示在列表中
   - 点击目录旁边的"删除"按钮可移除特定目录
   - 点击"清空所有"按钮可移除所有源目录

3. **添加目标目录**:
   - 目标目录的添加方式与之前版本相同
   - 同样支持多个目标目录

4. **开始处理**:
   - 选择处理选项（复制/移动、预览模式等）
   - 点击"开始处理"按钮
   - 程序会处理所有源目录的文件到所有目标目录

## 测试

创建了 `test_multi_source.py` 测试脚本：
- 自动创建测试目录结构
- 生成示例媒体文件
- 启动 GUI 进行手动测试
- 自动清理测试文件

运行测试：
```bash
python test_multi_source.py
```

## 兼容性

- 向后兼容：现有的单源目录使用方式仍然有效
- 界面改进：新的多目录选择器提供更好的用户体验
- 性能优化：改进的处理逻辑提供更好的性能和错误处理

## 技术细节

### 处理流程
1. 扫描所有源目录，统计总文件数
2. 对每个目标目录：
   - 对每个源目录：
     - 处理该源目录的文件到当前目标目录
     - 更新进度和统计信息
3. 汇总所有操作的统计信息
4. 显示最终结果

### 错误处理
- 单个源目录处理失败不会影响其他目录的处理
- 详细的错误日志帮助诊断问题
- 用户友好的错误消息和警告

### 取消操作
- 支持在任何时候取消处理操作
- 取消操作会停止所有后续的源目录和目标目录处理
- 已完成的操作不会被回滚
