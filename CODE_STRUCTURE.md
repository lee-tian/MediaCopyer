# MediaCopyer 代码结构文档

## 项目概述

MediaCopyer 是一个媒体文件组织工具，可以按日期或设备类型自动整理照片和视频文件。该项目采用模块化设计，支持图形界面和命令行界面，并提供国际化支持。

## 目录结构

```
MediaCopyer/
├── core/                    # 核心功能模块
│   ├── __init__.py         # 核心模块入口，导出主要功能
│   ├── metadata/           # 元数据处理模块
│   ├── device/             # 设备识别模块
│   ├── organizer/          # 文件组织模块
│   └── utils/              # 工具函数模块
├── gui/                    # 图形用户界面模块
│   ├── __init__.py         # GUI模块入口
│   ├── main_window.py      # 主窗口界面
│   ├── options_frame.py    # 选项配置界面
│   ├── processor.py        # 文件处理逻辑
│   ├── widgets.py          # 自定义控件
│   ├── styles.py           # 界面样式定义
│   ├── i18n.py            # 国际化支持
│   └── locales/           # 语言包目录
├── installer/              # 安装程序相关
├── resources/             # 资源文件目录
├── build/                 # 构建输出目录
└── dist/                  # 分发文件目录
```

## 核心模块 (core/)

### `core/__init__.py`
- **功能**: 核心模块的统一入口点
- **作用**: 导出所有子模块的关键功能，提供统一的API接口
- **主要导出**:
  - 元数据处理函数 (`get_file_type`, `get_file_date`, `get_creation_date_from_exif`)
  - 设备识别函数 (`get_device_name`, `get_device_from_exif`)
  - 文件组织函数 (`scan_directory`, `organize_file`, `organize_media_files`)
  - 工具函数 (`validate_directory`, `format_file_size`, `safe_filename`)
  - 支持的文件扩展名常量 (`PHOTO_EXTENSIONS`, `VIDEO_EXTENSIONS`)

### `core/metadata/`
- **功能**: 处理媒体文件的元数据信息
- **主要功能**:
  - 提取照片EXIF数据中的拍摄日期
  - 获取视频文件的创建时间
  - 识别文件类型（照片/视频）
  - 支持多种RAW格式和标准格式

### `core/device/`
- **功能**: 识别媒体文件的来源设备
- **主要功能**:
  - 从EXIF数据中提取设备信息
  - 从视频元数据中获取设备名称
  - 基于文件名模式推断设备类型
  - 设备名称规范化处理

### `core/organizer/`
- **功能**: 文件组织和管理的核心逻辑

#### `core/organizer/__init__.py`
- 导出组织模块的主要功能

#### `core/organizer/media_organizer.py`
- **功能**: 媒体文件组织的主要逻辑
- **主要功能**:
  - 按日期或设备类型组织文件
  - 生成目标目录结构
  - 处理重复文件名
  - 文件复制和移动操作

#### `core/organizer/scanner.py`
- **功能**: 目录扫描和文件发现
- **主要功能**:
  - 递归扫描源目录
  - 过滤媒体文件
  - 排除隐藏文件和系统文件
  - 统计文件信息

#### `core/organizer/file_operations.py`
- **功能**: 文件操作相关功能
- **主要功能**:
  - 安全的文件复制和移动
  - 文件完整性验证
  - 错误处理和恢复
  - 进度报告

#### `core/organizer/hash_utils.py`
- **功能**: 文件哈希和重复检测
- **主要功能**:
  - 计算文件MD5/SHA256哈希
  - 检测重复文件
  - 文件完整性验证

### `core/utils/`
- **功能**: 通用工具函数

#### `core/utils/__init__.py`
- 导出工具模块的功能

#### `core/utils/filesystem.py`
- **功能**: 文件系统相关工具
- **主要功能**:
  - 目录验证和创建
  - 磁盘空间检查
  - 文件大小格式化
  - 路径处理和规范化

#### `core/utils/string_utils.py`
- **功能**: 字符串处理工具
- **主要功能**:
  - 安全文件名生成
  - 字符编码处理
  - 路径字符串处理

## 图形界面模块 (gui/)

### `gui/__init__.py`
- **功能**: GUI模块入口
- **作用**: 导出主要的GUI组件和应用程序类

### `gui/main_window.py`
- **功能**: 主窗口界面实现
- **主要功能**:
  - 创建主应用程序窗口
  - 设置窗口布局和控件
  - 处理用户交互事件
  - 集成各个功能模块

### `gui/options_frame.py`
- **功能**: 选项配置界面
- **主要功能**:
  - 组织方式选择（按日期/按设备）
  - 源目录和目标目录选择
  - 高级选项配置
  - 设置保存和加载

### `gui/processor.py`
- **功能**: 文件处理后台逻辑
- **主要功能**:
  - 后台文件处理任务
  - 进度更新和状态报告
  - 错误处理和用户通知
  - 线程安全的GUI更新

### `gui/widgets.py`
- **功能**: 自定义GUI控件
- **主要功能**:
  - 进度显示控件
  - 文件选择控件
  - 状态显示组件
  - 可复用的UI元素

### `gui/styles.py`
- **功能**: GUI样式和主题定义
- **主要功能**:
  - 颜色方案定义
  - 字体和大小设置
  - 控件样式配置
  - 响应式布局样式

### `gui/i18n.py`
- **功能**: 国际化支持
- **主要功能**:
  - 语言切换管理
  - 文本本地化
  - 区域设置处理
  - 动态语言加载

### `gui/locales/`
- **功能**: 语言包目录

#### `gui/locales/zh_CN.py`
- **功能**: 简体中文语言包
- **内容**: 所有界面文本的中文翻译

#### `gui/locales/en_US.py`
- **功能**: 英文语言包
- **内容**: 所有界面文本的英文版本

## 主程序文件

### `media_copyer_gui.py`
- **功能**: GUI版本的主入口程序
- **作用**: 启动图形界面应用程序
- **特点**: 简洁的入口点，导入并启动GUI应用

### `media_copyer.py`
- **功能**: 命令行版本的主程序
- **作用**: 提供命令行界面的媒体文件组织功能
- **特点**: 支持脚本化和批处理操作

## 构建和分发

### `build_app.py`
- **功能**: 应用程序构建脚本
- **作用**: 使用PyInstaller构建可执行文件
- **支持平台**: macOS, Windows, Linux

### `build_all.py`
- **功能**: 全平台构建脚本
- **作用**: 自动化构建多个平台的版本

### `media_copyer.spec`
- **功能**: PyInstaller配置文件
- **作用**: 定义构建参数和依赖关系

### `create_ico.py`
- **功能**: 图标生成脚本
- **作用**: 从PNG文件生成各平台所需的图标格式

### `installer/`
- **功能**: 安装程序相关文件

#### `installer/build_installer.py`
- **功能**: 构建安装程序
- **作用**: 创建用户友好的安装包

#### `installer/run_installer.py`
- **功能**: 安装程序执行脚本
- **作用**: 处理安装过程和文件部署

## 资源文件

### `resources/`
- **功能**: 应用程序资源目录

#### `resources/icon.png`
- **功能**: 主图标文件
- **用途**: 应用程序图标的源文件

#### `resources/MediaCopyer.icns`
- **功能**: macOS图标文件
- **用途**: macOS应用程序图标

#### `resources/MediaCopyer.ico`
- **功能**: Windows图标文件
- **用途**: Windows应用程序图标

#### `resources/MediaCopyer.iconset/`
- **功能**: macOS图标集目录
- **内容**: 各种分辨率的图标文件

## 配置和文档

### `requirements.txt`
- **功能**: Python依赖列表
- **内容**: 项目所需的第三方库及版本要求

### `README.md`
- **功能**: 项目说明文档
- **内容**: 项目介绍、安装说明、使用方法

### `requirement.md`
- **功能**: 需求文档
- **内容**: 项目功能需求和技术要求

### `.gitignore`
- **功能**: Git忽略文件配置
- **内容**: 指定不需要版本控制的文件和目录

## 测试和工具

### `test_multi_source.py`
- **功能**: 多源测试脚本
- **作用**: 测试多个源目录的处理功能

### `fast_launcher.py`
- **功能**: 快速启动脚本
- **作用**: 提供快速启动应用程序的方式

### `run_media_copyer.sh`
- **功能**: Unix/Linux启动脚本
- **作用**: Shell脚本形式的程序启动器

### `MULTI_SOURCE_CHANGES.md`
- **功能**: 多源功能变更文档
- **内容**: 记录多源支持功能的开发变更

## 技术特性

### 核心功能
- **文件组织**: 按日期或设备类型自动组织媒体文件
- **元数据提取**: 从EXIF和视频元数据中提取信息
- **设备识别**: 智能识别文件来源设备
- **重复检测**: 基于哈希值的重复文件检测
- **批量处理**: 支持大量文件的批量组织

### 用户界面
- **图形界面**: 基于Tkinter的现代化GUI
- **国际化**: 支持中英文界面
- **进度显示**: 实时处理进度和状态反馈
- **配置管理**: 灵活的选项配置和保存

### 跨平台支持
- **多平台**: 支持Windows、macOS、Linux
- **打包分发**: 提供独立可执行文件
- **安装程序**: 用户友好的安装体验

这个项目展现了良好的模块化设计，清晰的职责分离，以及完整的软件开发生命周期支持，从开发到测试到分发都有相应的工具和脚本支持。
